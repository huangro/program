# TAOS SQL
## 1. 简介
本文档说明TAOS SQL支持的语法规则、主要查询功能、支持的SQL查询函数，以及常用技巧等内容。阅读本文档需要读者具有基本的SQL语言的基础。

TAOS SQL是用户对TDengine进行数据写入和查询的主要工具。TAOS SQL为了便于用户快速上手，在一定程度上提供类似于标准SQL类似的风格和模式。严格意义上，TAOS SQL并不是也不试图提供SQL标准的语法。此外，由于TDengine针对的时序性结构化数据不提供修改和更新功能，因此在TAO SQL中不提供数据更新和数据删除的相关功能。

本章节SQL语法遵循如下约定：
- < > 里的内容是用户需要输入的，但不要输入<>本身
- [ ] 表示内容为可选项，但不能输入[]本身
- | 表示多选一，选择其中一个即可，但不能输入|本身
- ... 表示前面的项可重复多个

为更好地说明SQL语法的规则及其特点，本文假设存在一个数据集。以智能电表(meters)为例，假设每个智能电表采集电流、电压、相位三个量。其建模如下：
```
taos> DESCRIBE meters;
             Field              |        Type        |   Length    |    Note    |
=================================================================================
 ts                             | TIMESTAMP          |           8 |            |
 current                        | FLOAT              |           4 |            |
 voltage                        | INT                |           4 |            |
 phase                          | FLOAT              |           4 |            |
 location                       | BINARY             |          64 | TAG        |
 groupid                        | INT                |           4 | TAG        |
```
数据集包含4个智能电表的数据，按照TDengine的建模规则，对应4个子表，其名称分别是 d1001, d1002, d1003, d1004。

## 2. 支持的数据类型
使用TDengine，最重要的是时间戳。创建并插入记录、查询历史记录的时候，均需要指定时间戳。时间戳有如下规则：
- 时间格式为`YYYY-MM-DD HH:mm:ss.MS`, 默认时间分辨率为毫秒。比如：`2017-08-12 18:25:58.128`
- 内部函数now是服务器的当前时间
- 插入记录时，如果时间戳为now，插入数据时使用服务器当前时间
- Epoch Time: 时间戳也可以是一个长整数，表示从`1970-01-01 08:00:00.000`开始的毫秒数
- 时间可以加减，比如 now-2h，表明查询时刻向前推2个小时(最近2小时)。 数字后面的时间单位可以是 a(毫秒)、s(秒)、 m(分)、h(小时)、d(天)、w(周)。 比如`select * from t1 where ts > now-2w and ts <= now-1w`, 表示查询两周前整整一周的数据。 在指定降频操作(down sampling)的时间窗口(interval)时，时间单位还可以使用 n(自然月) 和 y(自然年)。

TDengine缺省的时间戳是毫秒精度，但通过修改配置参数enableMicrosecond就可支持微秒。

在TDengine中，普通表的数据模型中可使用以下10种数据类型。

||类型|Bytes|说明|
|--|--|---|----|
|1|TIMESTAMP|8|时间戳。缺省精度毫秒，可支持微秒。从格林威治时间 `1970-01-01 00:00:00.000 (UTC/GMT)` 开始，计时不能早于该时间。|
|2|INT|4|整型，范围 [-2^31+1, 2^31-1], -2^31用作Null|
|3|BIGINT|8|长整型，范围 [-2^63+1, 2^63-1], -2^63用于NULL|
|4|FLOAT|4|浮点型，有效位数6-7，范围 [-3.4E38, 3.4E38]|
|5|DOUBLE|8|双精度浮点型，有效位数15-16，范围 [-1.7E308, 1.7E308]
|6|BINARY|自定义|用于记录字符串，理论上，最长可以有16374字节，但由于每行数据最多16K字节，实际上限一般小于理论值。 binary仅支持字符串输入，字符串两端使用单引号引用，否则英文全部自动转化为小写。使用时须指定大小，如binary(20)定义了最长为20个字符的字符串，每个字符占1byte的存储空间。如果用户字符串超出20字节将会报错。对于字符串内的单引号，可以用转义字符反斜线加单引号来表示， 即 \’。|
|7|SMALLINT|2|短整型， 范围 [-32767, 32767], -32768用于NULL|
|8|TINYINT|1|单字节整型，范围 [-127, 127], -128用于NULL|
|9|BOOL|1|布尔型，{true, false}|
|10|NCHAR|自定义|用于记录非ASCII字符串，如中文字符。每个nchar字符占用4bytes的存储空间。字符串两端使用单引号引用，字符串内的单引号需用转义字符 \’。nchar使用时须指定字符串大小，类型为nchar(10)的列表示此列的字符串最多存储10个nchar字符，会固定占用40bytes的空间。如用户字符串长度超出声明长度，则将会报错。|

**Tips:** TDengine对SQL语句中的英文字符不区分大小写，自动转化为小写执行。因此用户大小写敏感的字符串及密码，需要使用单引号将字符串引起来。

## 3. 数据库管理
### 3.1 创建数据库
```sql
CREATE DATABASE [IF NOT EXISTS] db_name [KEEP keep];
```
说明：
1. KEEP是该数据库的数据保留多长天数，缺省是3650天(10年)，数据库会自动删除超过时限的数据；
2. 数据库名最大长度为33；
3. 一条SQL 语句的最大长度为65480个字符；
4. 数据库还有更多与存储相关的配置参数，请参见 [系统管理](https://www.taosdata.com/cn/documentation20/administrator/#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE)。

### 3.2 使用数据库
```sql
USE db_name;
```
使用/切换数据库


## 备注
原文地址：https://www.taosdata.com/cn/documentation20/taos-sql/
